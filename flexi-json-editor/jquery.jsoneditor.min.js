(function(c){function q(a,b,d,f,e){a={target:a,onchange:d,original:b,propertyElement:f,valueElement:e};k(a,b,a.target);c(".property, .value",a.target).live("blur focus",function(){c(this).toggleClass("editing")})}function l(a){return Object.prototype.toString.call(a)=="[object Object]"}function m(a){return Object.prototype.toString.call(a)=="[object Array]"}function n(a,b,d){var f=arguments.length==2;if(b.indexOf(".")>-1){for(var e=a,g=0,h=b.split("."),i=h.length;g<i-1;g++)e=e[h[g]];if(f)delete e[h[i-
1]];else e[h[i-1]]=d}else if(f)delete a[b];else a[b]=d;return a}function r(a,b,d){b=b.split(".");for(var f=0;f<b.length;)if((a=a[b[f++]])==undefined)return d;return a}function o(a){if(a.children(".expander").length==0){var b=c("<span>",{"class":"expander"});b.bind("click",function(){c(this).parent().toggleClass("expanded")});a.prepend(b)}}function k(a,b,d,f){f=f||"";d.children(".item").remove();for(var e in b)if(b.hasOwnProperty(e)){var g=c("<div>",{"class":"item","data-path":f}),h=c(a.propertyElement||
"<input>",{"class":"property"}),i=c(a.valueElement||"<input>",{"class":"value"});if(l(b[e])||m(b[e]))o(g);g.append(h).append(i);d.append(g);h.val(e).attr("title",e);var j=JSON.stringify(b[e]);i.val(j).attr("title",j);s(a,b,h,i,e);if(l(b[e])||m(b[e]))k(a,b[e],g,(f?f+".":"")+e)}}function p(a,b){c(a).parentsUntil(b.target).each(function(){var d=c(this).data("path");d=(d?d+".":d)+c(this).children(".property").val();d=JSON.stringify(r(b.original,d,""));c(this).children(".value").val(d).attr("title",d)})}
function s(a,b,d,f,e){d.change(function(){var g=c(this).parent().data("path"),h=JSON.parse(c(this).next().val());c(this).attr("title",c(this).val());n(a.original,(g?g+".":"")+e);n(a.original,(g?g+".":"")+c(this).val(),h);p(this,a);a.onchange()});f.change(function(){var g=c(this).prev().val(),h=JSON.parse(c(this).val()),i=c(this).parent(),j=i.data("path");n(a.original,(j?j+".":"")+g,h);if(l(h)||m(h)){k(a,h,i,(j?j+".":"")+g);o(i)}p(this,a);a.onchange()})}c.fn.jsonEditor=function(a,b){b=b||{};var d,
f=b.change||function(){};return this.each(function(){q(c(this),a,f,b.propertyElement,b.valueElement)})}})(jQuery);
